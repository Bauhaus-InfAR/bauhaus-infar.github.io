{
  "hash": "d3008e299bd86b7531fcd2caf976d381",
  "result": {
    "markdown": "---\ntitle: \"Neufert 4.0 July 23 Progress Report\"\nauthor: \"Milan Valášek\"\ndate: \"07/17/2023\"\ndate-format: \"D MMM YYYY\"\ncategories: [Neufert 4.0, machine learning]\nformat: html\nexecute: \n  echo: false\n  warning: false\n  message: false\ntbl-cap-location: bottom\n---\n\n\n<style>\n    .table tr td, .table tr th {\n        padding: .25rem .25rem;\n    }\n    .table {\n        font-size: 0.875em;\n    }\n    .table-caption, caption {\n        text-align: left;\n    }\n    caption > p {\n        display: inline;\n    }\n</style>\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n## Motivation\n\nWe are attempting to build a deep neural network that would be able to predict likely characteristics of an apartment based solely on data derived from the geometry of its outline as well as basic variables related to the view from the apartment (_e.g._ whether or not a highway or railway is visible).\n\n## Data\n\nWe made use of the Neufert 4.0 data based on the [Swiss dwellings dataset](https://zenodo.org/record/7070952). We reviewed the original data, removing duplicates, cleaning the data of errors, and adding apartment and floor outline geometries.\nThe resulting dataset contained 14,607 entries (one per apartment). Based on the data, we calculated 178 features that encoded geometrical and view properties of the individual apartments. These features were used as input variables for the neural network models.\n\nAs output variables, we chose a number of continuous and categorical variables:\n\n\n::: {#tbl-cont .cell tbl-cap='Summary table of continuous outcome variables.'}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Variable </th>\n   <th style=\"text-align:right;\"> Min </th>\n   <th style=\"text-align:right;\"> Q1 </th>\n   <th style=\"text-align:right;\"> Median </th>\n   <th style=\"text-align:right;\"> Mean </th>\n   <th style=\"text-align:right;\"> Q3 </th>\n   <th style=\"text-align:right;\"> Max </th>\n   <th style=\"text-align:right;\"> Missing </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Corridor area ratio </td>\n   <td style=\"text-align:right;\"> 0.00 </td>\n   <td style=\"text-align:right;\"> 0.08 </td>\n   <td style=\"text-align:right;\"> 0.11 </td>\n   <td style=\"text-align:right;\"> 0.11 </td>\n   <td style=\"text-align:right;\"> 0.14 </td>\n   <td style=\"text-align:right;\"> 0.37 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Largest room sunlight </td>\n   <td style=\"text-align:right;\"> 0.00 </td>\n   <td style=\"text-align:right;\"> 0.40 </td>\n   <td style=\"text-align:right;\"> 0.65 </td>\n   <td style=\"text-align:right;\"> 0.72 </td>\n   <td style=\"text-align:right;\"> 0.95 </td>\n   <td style=\"text-align:right;\"> 3.93 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Largest room noise </td>\n   <td style=\"text-align:right;\"> 0.00 </td>\n   <td style=\"text-align:right;\"> 33.89 </td>\n   <td style=\"text-align:right;\"> 41.90 </td>\n   <td style=\"text-align:right;\"> 40.86 </td>\n   <td style=\"text-align:right;\"> 49.62 </td>\n   <td style=\"text-align:right;\"> 71.71 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Largest room kitchen distance </td>\n   <td style=\"text-align:right;\"> 0.25 </td>\n   <td style=\"text-align:right;\"> 0.25 </td>\n   <td style=\"text-align:right;\"> 0.75 </td>\n   <td style=\"text-align:right;\"> 1.42 </td>\n   <td style=\"text-align:right;\"> 2.00 </td>\n   <td style=\"text-align:right;\"> 142.25 </td>\n   <td style=\"text-align:right;\"> 33 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Kitchen sunlight </td>\n   <td style=\"text-align:right;\"> 0.00 </td>\n   <td style=\"text-align:right;\"> 0.80 </td>\n   <td style=\"text-align:right;\"> 1.62 </td>\n   <td style=\"text-align:right;\"> 1.81 </td>\n   <td style=\"text-align:right;\"> 2.56 </td>\n   <td style=\"text-align:right;\"> 9.55 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n::: {#tbl-binary .cell tbl-cap='Summary table of binary outcome variables.'}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Variable </th>\n   <th style=\"text-align:right;\"> No </th>\n   <th style=\"text-align:right;\"> Yes </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Has loggia </td>\n   <td style=\"text-align:right;\"> 9704 </td>\n   <td style=\"text-align:right;\"> 4903 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Bathroom has window </td>\n   <td style=\"text-align:right;\"> 3630 </td>\n   <td style=\"text-align:right;\"> 10977 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Distribution of the `number_of_rooms variable.](index_files/figure-html/fig-num-room-1.png){#fig-num-room width=672}\n:::\n:::\n\n\nThe dataset was split into a training set (_N_ = 8,744), development set (_N_ = 2,915), and test set (_N_ = 2,915). The development set was used for model evaluation during the hyperparameter tuning stage of the model development.\n\n## General neural network architecture\n\nThe chosen neural network consisted of blocs of fully connected layers with L2 regularisation, followed by a dropout layer. For every but the first bloc, we also included a skip connection from the previous bloc. The number of units per layer, the value of regularisation parameter ($\\lambda$), the dropout proportion, as well as the number of blocs in the network were treated as variable hyperparameters.\nFinally, a single-unit layer for each of the eight outcome variables was added in parallel to the end of the last bloc.\n\n## Hyperparameter search\n\nWe performed a grid search of the hyperparameter space defined by the following values:\n\n- Dropout: [0.3, 0.4, 0.5]\n- L2 regularisation parameter: [0.0001, 0.001, 0.01]\n- No. of blocs: 1-7\n- Number of units: [64, 128, 256]\n\nThe performance of the model was assessed according to the loss calculated on the validation set.\n\nAll models were trained using the Adam optimiser with a learning rate of 0.0001 for a maximum of 500 epochs. An early stopping rule was implemented with a patience of 20 epochs and a tolerance of 0.001, meaning that if the validation loss didn't improve for 20 epochs by more than 0.001, the training of the model was interrupted, reverting to the best weights to date.\n\n## Best model architecture\n\nBased on the hyperparameter tuning step described above, we settled on a model with the following characteristics:\n\n- Dropout: 0.3\n- L2 regularisation parameter: 0.0001\n- No. of blocs: 5\n- Number of units: 256\n\nA graphical representation of the model can be found in @fig-model below.\n\n:::{.column-screen-inset}\n![Schema of the best-performing model](model.png){#fig-model}\n:::\n\n## Model performance\n\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n### Does the apartment have a loggia?\n\nIn the table below, **sensitivity** refers to the ability of a test to detect and existing effect. If you have COVID, and take a PCR test, how likely is it to come back positive? **Specificity** on the other hand is the test's ability to accurately reject negative cases. If you do not have COVID, what is the probability that your PCR test comes back negative?\n\n\n::: {#tbl-loggia .cell tbl-cap='Performance of the model with respect to the `has_loggia` variable.'}\n::: {.cell-output-display}\n`````{=html}\n<table data-quarto-disable-processing=\"true\" class=\"table table-striped table-condensed\" style=\"margin-left: auto; margin-right: auto;border-bottom: 0;\">\n <thead>\n<tr>\n<th style=\"empty-cells: hide;border-bottom:hidden;\" colspan=\"1\"></th>\n<th style=\"empty-cells: hide;border-bottom:hidden;\" colspan=\"1\"></th>\n<th style=\"border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; \" colspan=\"3\"><div style=\"border-bottom: 1px solid #ddd; padding-bottom: 5px; \">Prediction</div></th>\n</tr>\n  <tr>\n   <th style=\"text-align:left;\">  </th>\n   <th style=\"text-align:left;\">  </th>\n   <th style=\"text-align:right;\"> Yes </th>\n   <th style=\"text-align:right;\"> No </th>\n   <th style=\"text-align:right;\"> Total </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\">  </td>\n   <td style=\"text-align:left;font-weight: bold;\"> Yes </td>\n   <td style=\"text-align:right;\"> 700 </td>\n   <td style=\"text-align:right;\"> 304 </td>\n   <td style=\"text-align:right;\"> 1004 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Truth </td>\n   <td style=\"text-align:left;font-weight: bold;\"> No </td>\n   <td style=\"text-align:right;\"> 173 </td>\n   <td style=\"text-align:right;\"> 1738 </td>\n   <td style=\"text-align:right;\"> 1911 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\">  </td>\n   <td style=\"text-align:left;font-weight: bold;\"> Total </td>\n   <td style=\"text-align:right;\"> 873 </td>\n   <td style=\"text-align:right;\"> 2042 </td>\n   <td style=\"text-align:right;\"> 2915 </td>\n  </tr>\n</tbody>\n<tfoot>\n<tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup></sup> Sensitivity: 69.7%</td></tr>\n<tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup></sup> Specificity: 90.9%</td></tr>\n<tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup></sup> Accuracy (not appropriate for imbalanced data): 83.6%</td></tr>\n</tfoot>\n</table>\n\n`````\n:::\n:::\n\n\n### Does the bathroom have a window?\n\n\n::: {#tbl-bathroom .cell tbl-cap='Performance of the model with respect to the `bathroom_has_window` variable.'}\n::: {.cell-output-display}\n`````{=html}\n<table data-quarto-disable-processing=\"true\" class=\"table table-striped table-condensed\" style=\"margin-left: auto; margin-right: auto;border-bottom: 0;\">\n <thead>\n<tr>\n<th style=\"empty-cells: hide;border-bottom:hidden;\" colspan=\"1\"></th>\n<th style=\"empty-cells: hide;border-bottom:hidden;\" colspan=\"1\"></th>\n<th style=\"border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; \" colspan=\"3\"><div style=\"border-bottom: 1px solid #ddd; padding-bottom: 5px; \">Prediction</div></th>\n</tr>\n  <tr>\n   <th style=\"text-align:left;\">  </th>\n   <th style=\"text-align:left;\">  </th>\n   <th style=\"text-align:right;\"> Yes </th>\n   <th style=\"text-align:right;\"> No </th>\n   <th style=\"text-align:right;\"> Total </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\">  </td>\n   <td style=\"text-align:left;font-weight: bold;\"> Yes </td>\n   <td style=\"text-align:right;\"> 1996 </td>\n   <td style=\"text-align:right;\"> 169 </td>\n   <td style=\"text-align:right;\"> 2165 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> Truth </td>\n   <td style=\"text-align:left;font-weight: bold;\"> No </td>\n   <td style=\"text-align:right;\"> 342 </td>\n   <td style=\"text-align:right;\"> 408 </td>\n   <td style=\"text-align:right;\"> 750 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\">  </td>\n   <td style=\"text-align:left;font-weight: bold;\"> Total </td>\n   <td style=\"text-align:right;\"> 2338 </td>\n   <td style=\"text-align:right;\"> 577 </td>\n   <td style=\"text-align:right;\"> 2915 </td>\n  </tr>\n</tbody>\n<tfoot>\n<tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup></sup> Sensitivity: 92.2%</td></tr>\n<tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup></sup> Specificity: 54.4%</td></tr>\n<tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup></sup> Accuracy (not appropriate for imbalanced data): 82.5%</td></tr>\n</tfoot>\n</table>\n\n`````\n:::\n:::\n\n\n### Number of rooms\n\nGiven the architecture of the network, the model predicted number of rooms as a continuous real number variable. For this reason, we rounded the prediction to whole number. Because the prediction domain was unconstrained, the model could predict a number of rooms smaller than one (this happened on two occasions) or larger than can reasonably be expected (on one occasion, it predicted 13 rooms).\n\nThese erroneous predictions aside, the model performance was as shown below:\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Confusion matrix of the number of rooms variable.](index_files/figure-html/fig-rooms-1.png){#fig-rooms width=672}\n:::\n:::\n\n\n\nThe model correctly predicted the number of rooms for 75.5% of the cases, with only 21 (0.72%) of predictions falling outside of the truth&pm;1 range.\n\n### Continuous variables\n\nThe sections below provide a summary of the model performance on continuous variables. The scatter plots show the relationship between the model prediction and the ground truth based on the test set. Included in the plot is a OLS line of best fit along with an 80% prediction interval.\n\nThe _R_^2^ statistic can be interpreted as the proportion of variance in the outcome variable accounted for by the predictor.\nThe _b_ coefficients are the intercept and slope of the line of best fit and should ideally have the value of 0 and 1, respectively.\n\nThe left plot of the pair includes all data except for the outliers listed below. The plot on the right hand side also excludes observations where the true value is zero.\n\n\n::: {.cell}\n\n:::\n\n\n### Circulation efficiency \n\n![](index_files/figure-html/unnamed-chunk-14-1.png){width=672}\n\n80% prediction interval = &pm;0.03\n\n\n\n_n_(x=0) = 139 \n\n\n\n### Kitchen-living room distance (m) \n\n![](index_files/figure-html/unnamed-chunk-14-2.png){width=672}\n\n80% prediction interval = &pm;0.93\n\n\n\n_n_(x=0) = 0 \n\n\n\n**Outliers**\n\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> Prediction </th>\n   <th style=\"text-align:right;\"> Truth </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> 912 </td>\n   <td style=\"text-align:right;\"> 38.82299 </td>\n   <td style=\"text-align:right;\"> 0.25 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 957 </td>\n   <td style=\"text-align:right;\"> 35.64644 </td>\n   <td style=\"text-align:right;\"> 2.50 </td>\n  </tr>\n</tbody>\n</table>\n\n### Living room sunlight (klx) \n\n![](index_files/figure-html/unnamed-chunk-14-3.png){width=672}\n\n80% prediction interval = &pm;0.27\n\n\n\n_n_(x=0) = 2 \n\n\n\n**Outliers**\n\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> Prediction </th>\n   <th style=\"text-align:right;\"> Truth </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> 957 </td>\n   <td style=\"text-align:right;\"> -7.644796 </td>\n   <td style=\"text-align:right;\"> 1.055584 </td>\n  </tr>\n</tbody>\n</table>\n\n### Living room noise (dB) \n\n![](index_files/figure-html/unnamed-chunk-14-4.png){width=672}\n\n80% prediction interval = &pm;7.81\n\n\n\n_n_(x=0) = 84 \n\n\n\n**Outliers**\n\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> Prediction </th>\n   <th style=\"text-align:right;\"> Truth </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> 957 </td>\n   <td style=\"text-align:right;\"> 133.8368 </td>\n   <td style=\"text-align:right;\"> 34.70842 </td>\n  </tr>\n</tbody>\n</table>\n\n### Kitchen sunlight (klx) \n\n![](index_files/figure-html/unnamed-chunk-14-5.png){width=672}\n\n80% prediction interval = &pm;0.89\n\n\n\n_n_(x=0) = 53 \n\n\n\n**Outliers**\n\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> Prediction </th>\n   <th style=\"text-align:right;\"> Truth </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> 957 </td>\n   <td style=\"text-align:right;\"> 19.02683 </td>\n   <td style=\"text-align:right;\"> 1.564121 </td>\n  </tr>\n</tbody>\n</table>\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\r\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}